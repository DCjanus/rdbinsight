# RDBInsight

RDBInsight 是一款 Redis 深度诊断工具，它通过将 RDB 快照转换为适合 OLAP 分析的结构化数据，帮助您排查复杂的内存和性能问题。

## 为什么需要 RDBInsight？

对于 Redis 的一些常见问题，如大 Key，市面上已有不少成熟的工具。然而，在真实的生产环境中，我们经常会遇到更棘手的"疑难杂症"：
*   某个数据清理脚本异常中断，导致节点间出现难以解释的内存倾斜。
*   由于 hash tag 使用不当，数据分布严重不均，但从监控上无法一目了然。
*   业务逻辑的微小缺陷，日积月累导致了大量难以归类的无用数据。

排查这些非标问题，往往需要运维人员编写一次性的脚本去扫描和分析，这不仅是大量的重复劳动，而且效率低下，缺乏系统性的方法。

## 核心理念：从"找问题"到"给能力"

RDBInsight 的核心理念不是预设要寻找的问题，而是赋予用户自由探索和诊断的能力。

它通过离线解析 RDB 文件，提取出轻量级的键元数据，并将其加载到 ClickHouse 中。一旦数据被结构化，您就可以利用 SQL 的全部威力，进行任意维度的、灵活的、深度的即席查询，从而能够：
*   生成内存火焰图，直观地发现任何粒度的键前缀的内存分布。
*   关联分析不同维度的数据，以验证您对复杂问题的任何猜想。
*   将重复的排查工作，沉淀为标准的、可复用的分析流程。

## 核心亮点

*   **流式解析架构**：轻松应对 GB 级大 Key，内存占用几乎恒定，不会因数据规模而崩溃
*   **灵活的 SQL 分析**：将 RDB 数据结构化后加载到 ClickHouse，支持任意维度的即席查询
*   **自包含 HTML 报告**：生成单文件、自包含的 HTML，包含直观的前缀火焰图，可离线查看集群完整信息和分析结果

## 数据模型

我们只提取核心元数据，以实现高效的分析和存储：

*   `cluster_name`: 来源集群名
*   `batch_id`: 导入批次 ID
*   `instance`: 实例名(IP:PORT)
*   `db`: 所属 DB
*   `key`: 键名
*   `rdb_size`: RDB 中的占用字节
*   `type`: 数据类型
*   `encoding`: 编码方式
*   `expire_at`: 过期时间
*   `members`: 集合类元素数量